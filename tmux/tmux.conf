# docs see https://man7.org/linux/man-pages/man1/tmux.1.html
# Sever-Session-Window-Pane

# TMUX in TMUX {{{
# If running inside tmux ($TMUX is set), then change the status line to red
%if #{TMUX}
set -g status-bg red
%endif
# }}}

# BASIC OPTIONS {{{

# server option
# true color https://github.com/tmux/tmux/issues/1246
set-option -sa default-terminal "xterm-256color"
# set-option -ga terminal-overrides ",xterm-256color:Tc"

# Change the default $TERM to tmux-256color
#set -g default-terminal "tmux-256color"

# Enable RGB colour if running in xterm(1)
# set-option -sa terminal-overrides ",xterm*:Tc"

# default command
# set-option -g default-command ""
set -g set-clipboard on


# swtich to another available session when exiting the last terminal in tmux session
set-option -g detach-on-destroy off

# neovim 
set-option -sg escape-time 10
# history limit
set -g history-limit 5000
# Mouse mode
set -g mouse on

# Start window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# renumber window when a window closed
set -g renumber-windows on
# clock style
setw -g clock-mode-style 24

# window vim mode
setw -g mode-keys vi
# status line emcas mode
# set -g status-keys emcas

# window activity notifier
setw -g monitor-activity on
set -g visual-activity on
#setw -g visual-bell off
#set -g bell-action off


# resize
setw -g aggressive-resize on

# for using vim-gitgutter
set -g focus-events on

# Window settings
set-window-option -g automatic-rename off
set-option -g set-titles on
set -g set-titles-string "#I:#W"

# fix path
bind '%' split-window -h -c '#{pane_current_path}'
bind '"' split-window -v -c '#{pane_current_path}' 
bind c new-window -c '#{pane_current_path}'

# }}}

# KEY MAPPINGS {{{
# C-a C-o     Rotate through the panes
# C-a C-z     Suspend the current client
# C-a Space   Select next layout
# C-a !       Break pane to a new window
# C-a #       List all paste buffers
# C-a $       Rename current session
# C-a &       Kill current window
# C-a '       Prompt for window index to select
# C-a (       Switch to previous client
# C-a )       Switch to next client
# C-a ,       Rename current window
# C-a -       Delete the most recent paste buffer
# C-a .       Move the current window
# C-a /       Describe key binding
# C-a 0       Select window 0
# C-a 1       Select window 1
# C-a 2       Select window 2
# C-a 3       Select window 3
# C-a 4       Select window 4
# C-a 5       Select window 5
# C-a 6       Select window 6
# C-a 7       Select window 7
# C-a 8       Select window 8
# C-a 9       Select window 9
# C-a :       Prompt for a command
# C-a ;       Move to the previously active pane
# C-a =       Choose a paste buffer from a list
# C-a ?       List key bindings
# C-a M       Clear the marked pane
# C-a [       Enter copy mode
# C-a ]       Paste the most recent paste buffer
# C-a d       Detach the current client
# C-a f       Search for a pane
# C-a i       Display window information
# C-a l       Select the previously current window
# C-a o       Select the next pane
# C-a q       Display pane numbers
# C-a s       Choose a session from a list
# C-a w       Choose a window from a list
# C-a z       Zoom the active pane
# C-a ~       Show messages
# C-a DC      Reset so the visible part of the window follows the cursor
# C-a PPage   Enter copy mode and scroll up
# C-a Up      Select the pane above the active pane
# C-a Down    Select the pane below the active pane
# C-a Left    Select the pane to the left of the active pane
# C-a Right   Select the pane to the right of the active pane
# C-a M-1     Set the even-horizontal layout
# C-a M-2     Set the even-vertical layout
# C-a M-3     Set the main-horizontal layout
# C-a M-4     Set the main-vertical layout
# C-a M-5     Select the tiled layout
# C-a M-n     Select the next window with an alert
# C-a M-o     Rotate through the panes in reverse
# C-a M-p     Select the previous window with an alert
# C-a M-Up    Resize the pane up by 5
# C-a M-Down  Resize the pane down by 5
# C-a M-Left  Resize the pane left by 5
# C-a M-Right Resize the pane right by 5
# C-a C-Up    Resize the pane up
# C-a C-Down  Resize the pane down
# C-a C-Left  Resize the pane left
# C-a C-Right Resize the pane right
# C-a S-Up    Move the visible part of the window up
# C-a S-Down  Move the visible part of the window down
# C-a S-Left  Move the visible part of the window left
# C-a S-Right Move the visible part of the window right

# list clients
bind * list-clients
# join pane
bind-key g command-prompt -p "send pane to:" "join-pane -t %%"
# Link window
bind-key e command-prompt -p "Link window from (session:window): " "link-window -s %% -a"
# swap window
# swap with the previous window first then select the previous window
bind \{ swap-window -t -1\; select-window -t -1
bind \} swap-window -t +1\; select-window -t +1

# kill pane
bind x kill-pane
bind X kill-window

# Move window to

# Move window from

# Move pane to

# Move pane from

# use tty-clock
unbind-key t 
bind-key t send-keys "tty-clock -c" Enter

# remap prefix from 'C-b' to 'C-a'
unbind-key C-b
unbind-key C-a
unbind-key C-d
set-option -g prefix C-a
bind-key -r C-a send-prefix

# list key-bindings
bind-key -n C-k list-keys

# reload 
bind r source-file ~/.tmux.conf \; display-message "tmux config reloaded."

# Split
bind v split-window -h
bind h split-window -v


# layouts
bind D source-file ~/.tmux/tmux_scripts/hsplit
bind E source-file ~/.tmux/tmux_scripts/vsplit
bind-key S source-file ~/.tmux/tmux_scripts/update_session_path

# Some extra key bindings to select higher numbered windows
bind F1 selectw -t:10
bind F2 selectw -t:11
bind F3 selectw -t:12
bind F4 selectw -t:13
bind F5 selectw -t:14
bind F6 selectw -t:15
bind F7 selectw -t:16
bind F8 selectw -t:17
bind F9 selectw -t:18
bind F10 selectw -t:19
bind F11 selectw -t:20
bind F12 selectw -t:21

# open in alacritty
# bind C run-shell -b 'alacritty --working-directory #{pane_current_path} -e tmux'

# reload (conflict with vim)
# bind C-r source-file ~/.tmux.conf \; display "Refleshed Configure!"

# HOOKS {{{
unbind-key O 
bind O show-hooks -g  # show all hooks
# set-hook client-attached display-message "ðŸš§ Connect âœ…"
# set-hook -g session-created 'clock-mode -t 1'
# set-hook -g window-linked 'selectw -n clock-mode -t 1'
# set-hook -g after-split-window 'selectl even-vertical'

# }}}

# MOVE AROUND {{{
# bind-key S new-session '#{sessin_path}'
# resize
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

# move between windows quickly
# Shift arrow to switch windows
bind-key -n -T prefix p previous-window 
bind-key -n -T prefix n next-window 

# unset for vim split movement
unbind-key -T root C-h
unbind-key -T root C-j
unbind-key -T root C-k
unbind-key -T root C-l

# use -n to avoid prefix
unbind-key -T root S-Up
unbind-key -T root S-Down
unbind-key -T root S-Left
unbind-key -T root S-Right
bind-key -T root S-Up select-pane -U
bind-key -T root S-Down select-pane -D
bind-key -T root S-Left select-pane -L
bind-key -T root S-Right select-pane -R

# combine with Meta key
# bind-key -n M-h resize-pane -L 5
# bind-key -n M-j resize-pane -D 5
# bind-key -n M-k resize-pane -U 5
# bind-key -n M-l resize-pane -R 5

# hjkl pane traversal
# bind-key h select-pane -L
# bind-key j select-pane -D
# bind-key k select-pane -U
# bind-key l select-pane -R

# swap pane
bind > swap-pane -D       # swap current pane with the next one
bind < swap-pane -U       # swap current pane with the previous one

# }}}

# COPY MODE {{{
# enter copy mode
bind Enter copy-mode
# set cursor in tmux with CSI codes
# see https://man7.org/linux/man-pages/man1/tmux.1.html#TERMINFO_EXTENSIONS
set-option -ga terminal-overrides ",xterm-256color:Tc,*:Ss=\033[%p1%d q:Se=\033[5 q"

# vim copy to system clipboard
if-shell '[[ $(uname -s) = Linux ]]' { 
   bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard" 
} { 
   bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy" 
}
# }}}

# Switch Session
# use default prefix-s

# tmux attach default session
# new-session -n $HOST

# Keys to toggle monitoring activity in a window and the synchronize-panes option
bind m set monitor-activity
bind y set synchronize-panes\; display 'synchronize-panes #{?synchronize-panes,on,off}'

# }}}

# PLUGINS {{{

# TPM 

# TODO: add local tmux package install support
set -g @plugin 'tmux-plugins/tpm'

# prefix + I  fetch and install plugins
# prefix + U  update plugins
# prefix + alt + u remove comment out plugins

# plugins {{{
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tizee/tmux-osinfo'
# set -g @plugin 'tizee/tmux-plugin-sysstat'
# set -g @plugin 'tizee/tmux-net-speed'
# set -g @plugin 'tizee/tmux-online-status'
set -g @plugin 'tmux-plugin/tmux-continuum'
# }}}

# tmux-resurrect {{{

# }}}

# tmux-continuum {{{
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'wezterm'
# }}}

# }}}

source ~/.config/tmux/tmux-theme.conf

# run all plugins 
run '~/.tmux/plugins/tpm/tpm'

# vim:ft=tmux:fdm=marker
